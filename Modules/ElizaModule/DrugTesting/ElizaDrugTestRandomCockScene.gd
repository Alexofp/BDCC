extends SceneBase

func _init():
	sceneID = "ElizaDrugTestRandomCockScene"

func _run():
	if(state == ""):
		addCharacter("eliza")
		playAnimation(StageScene.Duo, "stand", {npc="eliza"})
		saynn("[say=pc]Why don't you try this pill, Eliza?[/say]")

		saynn("[say=eliza]Me? Really?[/say]")

		saynn("She tilts her head slightly.")

		saynn("[say=eliza]You think I'd look good with a cock, huh~?[/say]")

		saynn("You shrug and try to hide your cunning smile, looking away.")

		saynn("[say=eliza]Yeah, I can see it in your eyes! But what if I get a bad one?[/say]")

		saynn("[say=pc]Which one is that?[/say]")

		saynn("She hums and scritches her chin.")

		saynn("[say=eliza]Well.. They're all good to be fair.[/say]")

		saynn("[say=pc]One more reason to try it, see what you get. Worst case, just get rid of it?[/say]")

		saynn("The feline stares at the pill in her paw.")

		saynn("[say=eliza]You don't realize.. I have the worst luck in the world..[/say]")

		saynn("[say=pc]It can't be that bad.[/say]")

		saynn("She pouts.. but throws the pill into her mouth, swallowing it with no regret.")

		saynn("The moment the drug hits Eliza's bloodstream, her eyes flutter as deep, pulsing heat begins to spread through her groin!")

		addButton("Continue", "See what happens next", "eliza_grows_cock")
	if(state == "eliza_grows_cock"):
		playAnimation(StageScene.Duo, "stand", {npc="eliza", npcAction="defeat", npcBodyState={exposedCrotch=true,hard=true}})
		saynn("Within seconds, Eliza's hips buckle under the weight of a rapidly enlarging cock under her skirt. She staggers, one hand braced against the lab equipment for support..")

		saynn("[say=eliza]Ah.. it's not slowing down![/say]")

		saynn("The outline of a shaft gets bigger and bigger on her skirt.. before her new giant horsecock suddenly rips it at the seams, together with the panties!")

		saynn("[say=eliza]AH! My skirt![/say]")

		saynn("The recoil from that giant, thick shaft getting set free makes Eliza collapse onto the floor.")

		saynn("You rush to help her.. but careful not to touch her new member.")

		saynn("[say=pc]Are you okay, Eliza?[/say]")

		saynn("Her massive shaft throbs in time with her racing heart, veins pulsing and bulging while the fat, flat tip drips with ropes of clear precum.")

		saynn("[say=eliza]Just about.. ohh-..[/say]")

		saynn("She is panting, looking at her cock.")

		saynn("[say=eliza]Yeah.. just my luck..[/say]")

		saynn("She tries to lift it, somehow making it swell even more.")

		saynn("[say=eliza]It's so big.. my balls, they're overflowing.. I feel lightheaded.. funny feeling, haha..[/say]")

		saynn("Probably because of how much blood this thing requires to stay hard.")

		saynn("You help her to get to a stool, her thighs quivering under the impossible load.")

		saynn("[say=pc]You need a blue pill?[/say]")

		saynn("[say=eliza]I.. need to be milked.. There is too much cum in these..[/say]")

		saynn("She looks around.")

		saynn("[say=eliza]There is a penis pump here somewhere.. I think.. I feel kinda high~.[/say]")

		saynn("You notice one.. attached to the belt that got snapped off when the skirt got torn. You hand it to the feline.")

		saynn("She secures it around the base of her cock.. but the device cracks and shatters into pieces the instant it meets the relentless pressure coming from her throbbing cock!")

		saynn("[say=eliza]Fuck! Too tight.[/say]")

		saynn("[say=pc]What now?[/say]")

		saynn("Eliza blinks.. while looking at you.. silently.")

		saynn("[say=pc]I'm gonna die if you shove it inside me, no way.[/say]")

		saynn("[say=eliza]Worth a shot. I guess we can try the advanced table, that one has an industrial pump installed![/say]")

		saynn("Whatever, anything will do by this point.")

		addButton("Table", "Bring her into the milking room", "eliza_in_milking_room")
	if(state == "eliza_in_milking_room"):
		playAnimation(StageScene.BDSMMachineFuck, "sex", {pc="eliza", bodyState={naked=true,hard=true,chains=[["hose", "penisPump", "scene", "milkIntake"]]}})
		aimCameraAndSetLocName("")
		saynn("Trying to make her stand with that giant cock seems like an impossible task, Eliza is just not strong enough. So you just roll her stool to the secluded room with the right equipment. You catch a few concerned glances from the nurses while pushing the stool through the corridors.. but Eliza assures them that everything is okay.")

		saynn("You find the room that Eliza wanted.")

		saynn("[say=eliza]The computer![/say]")

		saynn("You turn it on.. and follow the menus. Everything seems to be self-explanatory. When it comes time to choose who the table should operate on.. you choose Eliza.")

		saynn("Almost instantly, many mechanicals arms darted towards the feline, grabbing her and lifting her off of the chair and bringing her onto the table, making sure she is nice and secure.")

		saynn("Her cock is still hanging free between her legs.. until another manipulator aligns a pump with it.. and slides it onto the shaft.")

		saynn("[say=eliza]Mmhh~..[/say]")

		saynn("[say=pc]Why not just swallow that pill that undoes everything?[/say]")

		saynn("[say=eliza]And miss the opportunity to milk this giant load?![/say]")

		saynn("Everything makes sense now.")

		saynn("You let the computer commence the milking.")

		saynn("The pump seals itself onto her cock with a hiss of suction. Instantly, the two pleasure rings embedded in it spring to action, sliding along the veiny surface back and forth, stroking it.")

		saynn("[say=eliza]Mhh.. ah..[/say]")

		saynn("That wasn't everything though. Below Eliza, there was action happening too. The advanced table brings out one of its tools with a shiny dildo-like attachment. Eliza's body shudders as it suddenly starts prodding at one of her holes.")

		saynn("[say=eliza]Hey.. Wrong hole!.. ahh.. That's the wrong hole!..[/say]")

		saynn("The machine doesn't listen, it just keeps prodding Eliza's ass.. until her puckered anal star stretches enough to let the dildo inside!")

		saynn("[say=eliza]Ah!..[/say]")

		saynn("The dildo starts fucking her, sliding in and out at a steady pace, stimulating Eliza's prostate and making her squirm hard, her new cock throbbing and shooting little rivers of precum. The transparent fluid gushes freely, flooding the collection chamber.")

		saynn("[say=pc]I guess it was the right hole.[/say]")

		saynn("[say=eliza]Nhh-h.. ahh..[/say]")

		saynn("Each cycle of that pump.. coupled with the dildo pounding her tight ass.. sends ripples of electric pleasure through her veins.")

		saynn("You notice a funny button on the screen.. Double trouble..")

		addButton("Double trouble", "Press it", "double_trouble")
	if(state == "double_trouble"):
		playAnimation(StageScene.BDSMMachineFuck, "sexdouble", {pc="eliza", bodyState={naked=true,hard=true,chains=[["hose", "penisPump", "scene", "milkIntake"]]}})
		saynn("As you press that button, the table brings out its second dildo, aligning it with Eliza's neglected hole.. and ramming it inside!")

		saynn("[say=eliza]Ah! Yes![/say]")

		saynn("The two silicone cocks begin to fuck her in unison, one pressing insistently into her slick, dripping pussy while the other one is pounding her tight anus, stimulating her new pleasure button.")

		saynn("Simultaneously, the heavy-duty vacuum pump keeps sucking away at her giant cock, stimulating it with cycles of negative pressure while the pleasure rings run up and down along the hard, pulsing shaft.")

		saynn("Eliza throws her head back and moans into the air.")

		saynn("[say=eliza]F-fuck!.. That feels so good..[/say]")

		saynn("Her massive balls are tensing up, the tip of her member begins flaring up.")

		addButton("Continue", "See what happens next", "eliza_cums")
	if(state == "eliza_cums"):
		playAnimation(StageScene.BDSMMachineFuck, "fastdouble", {pc="eliza", bodyState={naked=true,hard=true,chains=[["hose", "penisPump", "scene", "milkIntake"]]}})
		saynn("Inside Eliza, the dildoes quicken their tempo. Her pussy clings and squeezes hard while her anus opens wide, welcoming the brutal thrusts. It all drives her closer and closer.")

		saynn("The pump's rings become a little too tight for her girth.. but they keep stroking her, going over her twitching shaft in precise motions.")

		saynn("And soon, it becomes too much. Eliza's cock starts throbbing, the head ballooning as veins spike with pressure. Moments later, what could only be described as a white geyser erupts, cum rocketing into the vacuum chamber with such force it leaves a crack in the glass.")

		saynn("[say=eliza]Cummmming~~!..[/say]")

		saynn("Her ballsack is tensing up, again and again, as the pleasure rings milk her orgasm for all of its seed, draining her orbs. Eliza's body arches in a convulsive way, muscles spasming and relaxing uncontrollably. Her pussy and anus contract in rapid succession, the tools extend her peak by pounding her hungry holes!")

		addButton("Turn off", "Enough fun for Eliza", "turn_off_machine")
	if(state == "turn_off_machine"):
		playAnimation(StageScene.BDSMMachineFuck, "tease", {pc="eliza", bodyState={naked=true,hard=true}})
		saynn("You turn off the milking when you see that Eliza's balls are fully drained.")

		saynn("When the final waves of her orgasm finish rocking through her, Eliza lies spent, her horsecock still leaking a bit.. the erection losing its power by the second. The dildoes retract with a soft hiss, leaving her holes empty.")

		saynn("[say=eliza]Now that.. felt good..[/say]")

		saynn("She is panting heavily, lazy moans still escaping her lips.")

		saynn("Might as well help her get down to her feet.")

		addButton("Continue", "See what happens next", "eliza_undo_tf")
	if(state == "eliza_undo_tf"):
		playAnimation(StageScene.Duo, "stand", {npc="eliza", npcBodyState={naked=true}})
		saynn("You press a button that makes the table carefully settle Eliza down. Her body is still quite weak so you support her.")

		saynn("[say=pc]Looked like you had a lot of fun. Gonna keep the new toy?[/say]")

		saynn("[say=eliza]And lose consciousness each time I get hard? That will happen pretty often, you know![/say]")

		saynn("[say=pc]Fair enough.[/say]")

		saynn("Eliza pops a blue pill into her mouth.. and watches as her equine sheath gets transformed away, morphing into a clean female crotch.")

		saynn("[say=eliza]Maybe I could whip one out occasionally.[/say]")

		saynn("You chuckle.")

		saynn("[say=eliza]But for now I'm gonna go try to sew my skirt back together.. what's left of it anyway.[/say]")

		saynn("[say=pc]You go do that.[/say]")

		saynn("Eliza nods and heads back to the lab.. naked.")

		addButton("Continue", "See what happens next", "endthescene")

func _react(_action: String, _args):
	if(_action == "endthescene"):
		endScene()
		return

	if(_action == "eliza_grows_cock"):
		processTime(5*60)
		setFlag("ElizaModule.elizatf_cock", "horse")
		getCharacter("eliza").updateBodyparts()
		getCharacter("eliza").fillBalls()

	if(_action == "eliza_in_milking_room"):
		processTime(5*60)
		var thePump = GlobalRegistry.createItem("PenisPump")
		getCharacter("eliza").getInventory().forceEquipStoreOtherUnlessRestraint(thePump)

	if(_action == "double_trouble"):
		processTime(5*60)

	if(_action == "eliza_cums"):
		processTime(3*60)
		GM.main.SCI.processMilkCharacterCustom(getCharacter("eliza"), BodypartSlot.Penis)

	if(_action == "turn_off_machine"):
		processTime(3*60)
		getCharacter("eliza").getInventory().clearSlot(InventorySlot.Penis)

	if(_action == "eliza_undo_tf"):
		setFlag("ElizaModule.elizatf_cock", "")
		getCharacter("eliza").updateBodyparts()
		if(!getFlag("ElizaModule.tfcan_cocks", false)):
			setFlag("ElizaModule.tfcan_cocks", true)
			addMessage("Eliza can now grow almost any cock if you tell her to.")

	setState(_action)
